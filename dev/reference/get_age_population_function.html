<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Return an interpolating function for populations in 1y age increments — get_age_population_function • conmat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Return an interpolating function for populations in 1y age increments — get_age_population_function"><meta name="description" content="This function returns an interpolating function to get
populations in 1y age increments from chunkier distributions produced by
socialmixr::wpp_age()."><meta property="og:description" content="This function returns an interpolating function to get
populations in 1y age increments from chunkier distributions produced by
socialmixr::wpp_age()."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conmat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/conmat-population.html">Conmat Population Data</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a></li>
    <li><a class="dropdown-item" href="../articles/example-pipeline.html">Example Pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/other-data-sources.html">Using other data sources</a></li>
    <li><a class="dropdown-item" href="../articles/parallel-computing.html">Parallel Computing</a></li>
    <li><a class="dropdown-item" href="../articles/sir-model.html">SIR modelling with conmat</a></li>
    <li><a class="dropdown-item" href="../articles/visualising-conmat.html">Visualisation gallery</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/idem-lab/conmat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Return an interpolating function for populations in 1y age increments</h1>
      <small class="dont-index">Source: <a href="https://github.com/idem-lab/conmat/blob/master/R/get_age_population_function.R" class="external-link"><code>R/get_age_population_function.R</code></a></small>
      <div class="d-none name"><code>get_age_population_function.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function returns an interpolating function to get
populations in 1y age increments from chunkier distributions produced by
<code><a href="https://epiforecasts.io/socialmixr/reference/wpp_age.html" class="external-link">socialmixr::wpp_age()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_age_population_function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'conmat_population'</span></span>
<span><span class="fu">get_age_population_function</span><span class="op">(</span>data <span class="op">=</span> <span class="va">population</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">get_age_population_function</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">population</span>,</span>
<span>  age_col <span class="op">=</span> <span class="va">lower.age.limit</span>,</span>
<span>  pop_col <span class="op">=</span> <span class="va">population</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>dataset containing information on population of a given
age/age group</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>extra arguments</p></dd>


<dt id="arg-age-col">age_col<a class="anchor" aria-label="anchor" href="#arg-age-col"></a></dt>
<dd><p>bare variable name for the column with age information</p></dd>


<dt id="arg-pop-col">pop_col<a class="anchor" aria-label="anchor" href="#arg-pop-col"></a></dt>
<dd><p>bare variable name for the column with population information</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An interpolating function to get populations in 1y age increments</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function first prepares the data to fit a smoothing spline to
the data for ages below the maximum age. It arranges the data by the lower
limit of the age group to obtain the bin width/differences of the lower
age limits. The mid point of the bin width is later added to the ages and
the population is scaled as per the bin widths. The maximum age is later
obtained and the populations for different above and below are filtered out
along with the sum of populations with and without maximum age. A cubic
smoothing spline is then fitted to the data for ages below the maximum with
predictor variable as the ages with the mid point of the bins added to it
where as the response variable is the log-scaled population. Using the
smoothing spline fit, the predicted population of ages 0 to 200 is obtained
and the predicted population is adjusted further using a ratio of the sum
of the population across all ages from the data and predicted population.
The ratio is based on whether the ages are under the maximum age as the
total population across all ages differs for ages above and below the
maximum age. The maximum age population is adjusted further to drop off
smoothly, based on the weights. The final population is then linearly
extrapolated over years past the upper bound from the data. For ages above
the maximum age from data, the population is calculated as a weighted
population of the maximum age that depends on the years past the upper
bound. Older ages would have lower weights, therefore lower population.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">polymod_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">polymod_pop</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 21 × 2</span> <span style="color: #BB0000;">(conmat_population)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">lower.age.limit</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    lower.age.limit population</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>               0   1<span style="text-decoration: underline;">898</span>966.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>               5   2<span style="text-decoration: underline;">017</span>632.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>              10   2<span style="text-decoration: underline;">192</span>410.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>              15   2<span style="text-decoration: underline;">369</span>985.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>              20   2<span style="text-decoration: underline;">467</span>873.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>              25   2<span style="text-decoration: underline;">484</span>327.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>              30   2<span style="text-decoration: underline;">649</span>826.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>              35   3<span style="text-decoration: underline;">043</span>704.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>              40   3<span style="text-decoration: underline;">117</span>812.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>              45   2<span style="text-decoration: underline;">879</span>510.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 11 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># But these ages and populations are binned every 5 years. So we can now</span></span></span>
<span class="r-in"><span><span class="co"># provide a specified age and get the estimated population for that 1 year</span></span></span>
<span class="r-in"><span><span class="co"># age group. First we create the new function like so</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">age_pop_function</span> <span class="op">&lt;-</span> <span class="fu">get_age_population_function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">polymod_pop</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Then we pass it a year to get the estimated population for a particular age</span></span></span>
<span class="r-in"><span><span class="fu">age_pop_function</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 385331.6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or a vector of years, to get the estimated population for a particular age</span></span></span>
<span class="r-in"><span><span class="co"># range</span></span></span>
<span class="r-in"><span><span class="fu">age_pop_function</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 369379.0 374617.8 379931.3 385331.6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Notice that we get a _pretty similar_ number of 0-4 if we sum it up, as</span></span></span>
<span class="r-in"><span><span class="co"># the first row of the table:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">polymod_pop</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 2</span> <span style="color: #BB0000;">(conmat_population)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">lower.age.limit</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lower.age.limit population</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>               0   1<span style="text-decoration: underline;">898</span>966.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">age_pop_function</span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1873473</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Usage in dplyr</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span><span class="va">abs_education_state</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>population_est <span class="op">=</span> <span class="fu">age_pop_function</span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    year state aboriginal_and_torres_…¹   age n_full_and_part_time population_est</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>006 ACT   Aboriginal and Torres S…     4                    5        <span style="text-decoration: underline;">385</span>332.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>006 ACT   Non-Indigenous               4                  109        <span style="text-decoration: underline;">385</span>332.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>006 NSW   Aboriginal and Torres S…     4                  104        <span style="text-decoration: underline;">385</span>332.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>006 NSW   Non-Indigenous               4                 <span style="text-decoration: underline;">1</span>870        <span style="text-decoration: underline;">385</span>332.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>006 NT    Aboriginal and Torres S…     4                  102        <span style="text-decoration: underline;">385</span>332.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ abbreviated name: ¹​aboriginal_and_torres_strait_islander_status</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Nicholas Tierney, <a href="https://www.telethonkids.org.au/contact-us/our-people/g/nick-golding/" class="external-link">Nick Golding</a>, <a href="https://aarathybabu.netlify.app/" class="external-link">Aarathy Babu</a>, Chitra Saraswati, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

